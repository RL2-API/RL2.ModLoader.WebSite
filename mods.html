<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Mods</title>
	<link rel="stylesheet" href="styles/mods.css">
	<link rel="stylesheet" href="styles/common.css">
	<link rel="stylesheet" href="styles/links.css">
	<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=JetBrains Mono'>
</head>
	
<body class="background base-layout">
	<nav class="navbar">
		|
		<div class="navbar-element">
			<a href="https://github.com/RL2-API/RL2.ModLoader/releases/latest" class="link">
				<h2>Download</h2>
			</a>
		</div>
		|
		<div class="navbar-element">
			<img src="https://raw.githubusercontent.com/RL2-API/RL2.ModLoader/main/Assets/ModLoaderIcon-NoText-700x700.png" class="icon-small"/>
			&ensp;&ensp;
			<a href="/" class="link">
				<h2>RL2.ModLoader</h2>
			</a>
		</div>
		|
		<div class="navbar-element">
			<a href="/mods/" class="link">
				<h2>Mods</h2>
			</a>
		</div>
		|
	</nav>

	<main class="width-full">
		<div class="width-full base-layout" id="mod-list"></div>

	</main>
</body>
</html>

<!-- Delete later -->
<script type="module">

// SolidJS
import { createSignal, createEffect, createResource, For } from "https://esm.sh/solid-js@1.8.1";
import { render } from "https://esm.sh/solid-js@1.8.1/web";
import h from "https://esm.sh/solid-js@1.8.1/h";
import html from "https://esm.sh/solid-js@1.8.1/html";
// Database
import { createClient } from "https://esm.sh/@libsql/client"

const db = createClient({
	url: "https://rl2-mod-store-tacoconkvass.aws-eu-west-3.turso.io",
  authToken: "eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVCJ9.eyJhIjoicm8iLCJpYXQiOjE3MzI4ODk5NjcsImlkIjoiOTJiYmNjYmMtZDU1Yy00MWNkLTkxMmEtNTM1MjU1Yzk1OGZmIn0.oQs2JAoq6lCJuyIPQglcIBvjJtCbx2cDxinvhJIVcqOzst6kesnX95zz9ZL46-UTfrNKazpv1s6dOfTYew0JAg",
})

const ModList = () => {
	const [data] = createResource(
		async () => {
			const result = await db.execute("SELECT name, description, author, icon_src FROM shortinfo GROUP BY name");
			return result.rows;
		}
	);

	const [filtered, filter] = createSignal([])
	const	[search, setSearch] = createSignal('');

	return () => html`
		<input type='search' placeholder='Search...' onInput=${(e) => { setSearch(e.target.value);
			filter(
				search().length == 0 ? data() :
				data().filter(item => item.name.includes(search()))
			)
		}}/>

		<${For} each=${() => search().length == 0 ? data() : filtered()}>
			${(item) => html`
				<article class="mod margin-5-scalable" onClick=${(e) => window.location = '/mod?name=' + item.name }>
					<div class="icon paddingless margin-10">
						<img src="${item.icon_src}" class="icon"/>
					</div>

					<div class="details width-full margin-10">
						<div class="title">
							<p class="size-big-scalable marginless">${item.name}</p>
							<p class="width-full left-aligned margin-10">by ${item.author}</p>
						</div>
							
						<div class="description left-aligned">
							${item.description}
						</div>
					</div>
				</article>   
			`
		}
	`;
};
	
render(ModList, document.getElementById("mod-list"));

</script>
